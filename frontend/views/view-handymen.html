<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile</title>
    <link rel="stylesheet" href="../public/css/my-handyman-profile.css">
    <link rel="stylesheet" href="../public/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="./config.js"></script>
    <script src="./my-handyman-profile.js"></script>
    <style>
        
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 0.94rem;
            margin: 1.25rem 0;
        }
        
        .btn {
            padding: 0.625rem 0.94rem;
            border-radius: 5px;
            text-decoration: none;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn-call {
            background-color: #4CAF50;
            color: white;
        }
        
        .btn-message {
            background-color: #2196F3;
            color: white;
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(12.5rem, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .service-item {
            display: flex;
            justify-content: center;
            padding: 0.625rem 6.25rem;
            text-align: center;
            border: 3px solid #000000;
            border-radius: 3.125rem;
        }
        
        .portfolio-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 1.25rem;
        }
        
        .portfolio-item {
            aspect-ratio: 1;
            overflow: hidden;
            border-radius: 8px;
            position: relative;
        }
        
        .portfolio-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        @media (max-width: 37.5rem) {
            .portfolio-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 80%;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="back-header">
        <a class="back-btn" href="../index.html">&lt;Back</a>
    </div>
    <section class="profile-header"> 
        <div class="image-container">
            <img src="../public/images/handyman-profiles/profile4.jpeg" alt="my profile">
        </div>
        <p class="handyman-name">Mamadou Bah</p>
        <p class="handyman-job">Electrician</p>
        <span class="rating"> 
            <i class="fas fa-star" style="color: orange;"></i>
            <i class="fas fa-star" style="color: orange;"></i>
            <i class="fas fa-star" style="color: orange;"></i>
            <i class="fas fa-star" style="color: orange;"></i>
            <i class="fas fa-star-half-alt" style="color: orange;"></i>
            <span>4.5</span>
        </span>
        
      
        <div class="action-buttons">
       <a id="bookNowBtn" href="#" class="btn btn-call">Book Now</a>

            <a href="sms:+2203281914" class="btn btn-message">Call Now</a>
        </div>
    </section>
    
  
    <div class="tabs">
        <button class="tab active" onclick="switchTab('about')">About</button>
        <button class="tab" onclick="switchTab('portfolio')">Portfolio</button>
        <button class="tab" onclick="switchTab('reviews')">Reviews</button>
    </div>

   
    <div class="tab-content" id="about">
        <h3>Services Offered</h3>
        <div class="services-grid">
            <div class="service-item">Electrical Wiring</div>
            <div class="service-item">Light Fixtures</div>
            <div class="service-item">Circuit Breakers</div>
            <div class="service-item">Outlet Installation</div>
            <div class="service-item">Electrical Repairs</div>
        </div>
        
        <h3 style="margin-top: 20px;">Location</h3>
        <p>Lamin, The Gambia</p>
        
        <h3 style="margin-top: 20px;">Availability</h3>
        <p>Monday - Friday: 8:00 AM - 6:00 PM</p>
        <p>Saturday: 9:00 AM - 2:00 PM</p>
    </div>
    
    <!-- Portfolio Tab Content -->
    <div class="tab-content hidden" id="portfolio">
        <h3>My Work</h3>
        <div class="portfolio-grid">
            <div class="portfolio-item">
                <img src="./public/images/light-fixture.jpg" alt="Electrical Work" class="portfolio-img">
            </div>
            <div class="portfolio-item">
                <img src="./public/images/light-fixture.jpg" alt="Light Installation" class="portfolio-img">
            </div>
            <div class="portfolio-item">
                <img src="./public/images/tv-mounting.jpg" alt="Wiring Project" class="portfolio-img">
            </div>
            <div class="portfolio-item">
                <img src="./public/images/circuit-repair.jpg" alt="Circuit Repair" class="portfolio-img">
            </div>
        </div>
    </div>
    
    <!-- Reviews Tab Content (kept your existing reviews) -->
    <div class="tab-content hidden" id="reviews">
        <div class="review">
            <span class="rating"> 
                <i class="fas fa-star" style="color: orange;"></i>
                <i class="fas fa-star" style="color: orange;"></i>
                <i class="fas fa-star" style="color: orange;"></i>
                <i class="fas fa-star" style="color: orange;"></i>
                <i class="fas fa-star-half-alt" style="color: orange;"></i>
                <span>4.5</span>
            </span>
            <p class="rating-description">Reliable and Quick</p>
            <p class="rating-user">Fatou Bah</p>
        </div>
      </div>

     <script>
        document.addEventListener('DOMContentLoaded', async () => {
  function getQueryParam(param) {
    return new URLSearchParams(window.location.search).get(param);
  }

  const handymanId = getQueryParam('handymanId');
  if (!handymanId) {
    alert('No handyman specified');
    return;
  }

  try {
    const response = await fetch(`${CONFIG.API_BASE_URL}/api/handymen/${handymanId}`);
    if (!response.ok) throw new Error('Failed to fetch handyman data');
    const handyman = await response.json();

   
    const img = document.querySelector('.image-container img');
    img.src = handyman.profileImage
      ? `${CONFIG.API_BASE_URL}/${handyman.profileImage}`
      : './public/images/handyman-profiles/default-profile.jpg';
    img.alt = `${handyman.firstName} ${handyman.lastName}`;

   
    document.querySelector('.handyman-name').textContent = `${handyman.firstName} ${handyman.lastName}`;
    document.querySelector('.handyman-job').textContent = handyman.profession || handyman.job || 'No profession set';

  
    const ratingSpan = document.querySelector('.rating');
    ratingSpan.innerHTML = generateStars(handyman.ratingAverage || 0) + ` <span>${(handyman.ratingAverage || 0).toFixed(1)}</span>`;

    
    const servicesGrid = document.querySelector('.services-grid');
    if (servicesGrid && handyman.services && handyman.services.length) {
      servicesGrid.innerHTML = '';
      handyman.services.forEach(service => {
        const div = document.createElement('div');
        div.className = 'service-item';
        div.textContent = service;
        servicesGrid.appendChild(div);
      });
    }

    // Update location
    const aboutTab = document.getElementById('about');
    const locationPara = aboutTab.querySelector('p:nth-of-type(2)');
    if (locationPara) locationPara.textContent = handyman.location || 'No location specified';

    // Update availability
    const availabilityParagraphs = aboutTab.querySelectorAll('p:nth-of-type(n+3)');
    if (handyman.availability) {
      if (typeof handyman.availability === 'string') {
        availabilityParagraphs.forEach(p => p.textContent = handyman.availability);
      } else if (typeof handyman.availability === 'object') {
        if (availabilityParagraphs.length >= 2) {
          availabilityParagraphs[0].textContent = handyman.availability.weekdays || '';
          availabilityParagraphs[1].textContent = handyman.availability.saturday || '';
        }
      }
    }

    // Update portfolio images
    const portfolioGrid = document.querySelector('.portfolio-grid');
    if (portfolioGrid && handyman.portfolio && handyman.portfolio.length) {
      portfolioGrid.innerHTML = '';
      handyman.portfolio.forEach(imgUrl => {
        const div = document.createElement('div');
        div.className = 'portfolio-item';
        div.innerHTML = `<img src="${imgUrl}" alt="Portfolio image" class="portfolio-img">`;
        portfolioGrid.appendChild(div);
      });
    }

    // Update reviews
    const reviewsContainer = document.getElementById('reviews');
    if (reviewsContainer && handyman.reviews && handyman.reviews.length) {
      reviewsContainer.innerHTML = '';
      handyman.reviews.forEach(review => {
        const div = document.createElement('div');
        div.className = 'review';
        div.innerHTML = `
          <span class="rating">${generateStars(review.rating)} <span>${review.rating.toFixed(1)}</span></span>
          <p class="rating-description">${review.comment || ''}</p>
          <p class="rating-user">${review.customerName || 'Anonymous'}</p>
        `;
        reviewsContainer.appendChild(div);
      });
    }

   
    const bookNowBtn = document.getElementById('bookNowBtn');
    if (bookNowBtn) {
      localStorage.setItem('handyman', JSON.stringify(handyman));

     
      bookNowBtn.href = `booking.html?handymanId=${handyman._id}`;
    }

  } catch (error) {
    console.error(error);
    alert('Failed to load handyman profile.');
  }
});


function generateStars(rating) {
  let stars = '';
  for (let i = 1; i <= 5; i++) {
    if (rating >= i) stars += '<i class="fas fa-star" style="color: orange;"></i>';
    else if (rating >= i - 0.5) stars += '<i class="fas fa-star-half-alt" style="color: orange;"></i>';
    else stars += '<i class="far fa-star" style="color: orange;"></i>';
  }
  return stars;
}

     </script>
</body>